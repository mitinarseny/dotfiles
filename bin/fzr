#!/bin/sh -e

FZF_OPTS="$@"
CONFIG_DIR=${XDG_CONFIG_HOME:-${HOME}/.config}/fzr

_fzr() {
  fzf \
    --no-multi --with-nth 2.. --read0 --delimiter '\n' \
    --cycle --layout=reverse --info=hidden \
    --color='bg:-1,fg:-1,preview-bg:-1,preview-fg:-1' \
    --color='hl:2,hl+:2,fg+:-1,bg+:0' \
    --color='gutter:-1,query:-1,prompt:6,pointer:5,spinner:8' \
    "$@" | head -n 1
}

if [ -t 0 ]; then
  [ -d "${CONFIG_DIR}" ] && [ -x "${CONFIG_DIR}" ] || exit 1
  COMMAND="$(find -L ${CONFIG_DIR} -type f -executable -printf '%p\n%P\0' 2>/dev/null | _fzr "$@")"
else
  COMMAND="$(_fzr "$@")"
fi

[ -n "${COMMAND}" ] || exit 1

if [ -t 1 ]; then
  exec ${COMMAND} </dev/tty
else
  echo "${COMMAND}"
fi
